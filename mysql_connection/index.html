<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Mysql Connection - wlupus blog</title><meta name=author content="wlupus: https://wlupus.github.io"><meta name=description content="Mysql crash的解决方法"><meta name=keywords content="mysql"><meta itemprop=name content="Mysql Connection"><meta itemprop=description content="Mysql crash的解决方法"><meta itemprop=datePublished content="2022-08-13T20:39:54+08:00"><meta itemprop=dateModified content="2022-08-13T21:07:16+08:00"><meta itemprop=wordCount content="412"><meta itemprop=image content="https://wlupus.github.io/mysql_connection/twitter_heripiro_1528778647561465857.jpg"><meta itemprop=keywords content="mysql,"><meta property="og:title" content="Mysql Connection"><meta property="og:description" content="Mysql crash的解决方法"><meta property="og:type" content="article"><meta property="og:url" content="https://wlupus.github.io/mysql_connection/"><meta property="og:image" content="https://wlupus.github.io/mysql_connection/twitter_heripiro_1528778647561465857.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-13T20:39:54+08:00"><meta property="article:modified_time" content="2022-08-13T21:07:16+08:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://wlupus.github.io/mysql_connection/twitter_heripiro_1528778647561465857.jpg"><meta name=twitter:title content="Mysql Connection"><meta name=twitter:description content="Mysql crash的解决方法"><meta name=application-name content="wlupus"><meta name=apple-mobile-web-app-title content="wlupus"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#252627"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://wlupus.github.io/mysql_connection/><link rel=prev href=https://wlupus.github.io/git_proxy_settings/><link rel=next href=https://wlupus.github.io/react_tutorial/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Mysql Connection","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/wlupus.github.io\/mysql_connection\/"},"image":[{"@type":"ImageObject","url":"https:\/\/wlupus.github.io\/mysql_connection\/twitter_heripiro_1528778647561465857.jpg","width":1101,"height":1280}],"genre":"posts","keywords":"mysql","wordcount":412,"url":"https:\/\/wlupus.github.io\/mysql_connection\/","datePublished":"2022-08-13T20:39:54+08:00","dateModified":"2022-08-13T21:07:16+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"wlupus","logo":{"@type":"ImageObject","url":"https:\/\/wlupus.github.io\/images\/avatar.png","width":634,"height":634}},"author":{"@type":"Person","name":"wlupus"},"description":"Mysql crash的解决方法"}</script></head><body header-desktop=sticky header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="wlupus blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/logo.svg data-srcset="/images/logo.svg, /images/logo.svg 1.5x, /images/logo.svg 2x" data-sizes=auto alt=/images/logo.svg title=/images/logo.svg><span class=header-title-text>wlupus</span></a><span class=header-subtitle></span></div><nav><ul class=menu><li class=menu-item><a class=menu-link href=/posts/><i class='fas fa-archive fa-fw fa-sm'></i> 所有文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fas fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class='fas fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class='fas fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class='fas fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item delimiter"></li><li class="menu-item language"><span title=选择语言>简体中文<i class="dropdown-icon fas fa-chevron-down"></i></span><ul class=sub-menu><li class=menu-item>没有更多翻译</li></ul></li><li class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></li></ul></nav><a href=https://github.com/wlupus/wlupus.github.io title="在 GitHub 上查看源代码" target=_blank rel="external nofollow noopener noreffer" class=github-corner><svg width="56" height="56" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg></a></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="wlupus blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/logo.svg data-srcset="/images/logo.svg, /images/logo.svg 1.5x, /images/logo.svg 2x" data-sizes=auto alt=/images/logo.svg title=/images/logo.svg><span class=header-title-text>wlupus</span></a><span class=header-subtitle></span></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><nav><ul class=menu id=menu-mobile><li class=menu-item><a class=menu-link href=/posts/><i class='fas fa-archive fa-fw fa-sm'></i> 所有文章</a></li><li class=menu-item><a class=menu-link href=/categories/><i class='fas fa-th fa-fw fa-sm'></i> 分类</a></li><li class=menu-item><a class=menu-link href=/tags/><i class='fas fa-tags fa-fw fa-sm'></i> 标签</a></li><li class=menu-item><a class=menu-link href=/friends/ title=友情链接><i class='fas fa-users fa-fw fa-sm'></i> 友链</a></li><li class=menu-item><a class=menu-link href=/about/><i class='fas fa-info-circle fa-fw fa-sm'></i> 关于</a></li><li class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></li><li class="menu-item language"><span title=选择语言>简体中文<i class="dropdown-icon fas fa-chevron-down"></i></span>
<select class=language-select onchange="location=this.value"><option disabled>没有更多翻译</option></select></li></ul></nav></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=container page-style=normal><aside class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></aside><aside class=aside-custom></aside><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Mysql Connection</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://wlupus.github.io title=Author target=_blank rel="external nofollow noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>wlupus</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/bug%E8%AE%B0%E5%BD%95/><i class="far fa-folder fa-fw"></i>Bug记录</a></span></div><div class=post-meta-line><span title="2022-08-13 20:39:54"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-08-13>2022-08-13</time>
</span>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 412 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 1 分钟&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/mysql_connection/twitter_heripiro_1528778647561465857.jpg data-srcset="/mysql_connection/twitter_heripiro_1528778647561465857.jpg, /mysql_connection/twitter_heripiro_1528778647561465857.jpg 1.5x, /mysql_connection/twitter_heripiro_1528778647561465857.jpg 2x" data-sizes=auto alt=/mysql_connection/twitter_heripiro_1528778647561465857.jpg title="Mysql crash的解决方法"></div><div class="details toc" id=toc-static kept=false><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#1-问题描述>1 问题描述</a></li><li><a href=#2-解决方案>2 解决方案</a></li><li><a href=#3-反思>3 反思</a></li></ul></nav></div></div><div class=content id=content><h2 id=1-问题描述>1 问题描述</h2><p>在使用<code>mysql-connector-python</code>库的时候，发现每当页面发起多次http请求的时候，就会导致mysql crash。</p><h2 id=2-解决方案>2 解决方案</h2><p>经过查看相关代码逻辑，推测是多次请求同时调用了数据库，导致了这个问题。在网上搜索相关的内容，推测是因为mysql的connection不是线程安全的，将全局共用的connection修改为单个线程使用，即可解决这个问题。</p><h2 id=3-反思>3 反思</h2><p>之所以会有全局共用一个connection的奇葩写法，是因为这个项目是在一个开源项目的基础上改的，那个旧的项目采用了这种奇葩写法，又因为那个项目一个页面只会有一个请求会查询sql，所以这个问题就隐藏了。在使用的变量涉及到多线程时(例如在处理http请求时)，一定要考虑是否是线程安全的。</p><div class="details admonition info open"><div class="details-summary admonition-title"><i class="icon fas fa-info-circle fa-fw"></i>潜在问题<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>在Stack Overflow上有看到使用connection pool的解决方案，推测是反复创建并销毁connection开销比较大，可以留作后续的改进方案</div></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span title="2022-08-13 21:07:16">更新于 2022-08-13&nbsp;<a class=git-hash href=https://github.com/wlupus/wlupus.github.io/commit/3137be0cc6d8ff4df29396676cd7bea6a0ee6694 rel="external nofollow noopener noreffer" target=_blank title="commit by wlupus(arthurreload@outlook.com) 3137be0cc6d8ff4df29396676cd7bea6a0ee6694: add mysql, rm ssss">
<i class="fas fa-hashtag fa-fw"></i>3137be0</a></span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/mysql_connection/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Twitter" data-sharer=twitter data-url=https://wlupus.github.io/mysql_connection/ data-title="Mysql Connection" data-via=wlupus1 data-hashtags=mysql><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://wlupus.github.io/mysql_connection/ data-hashtag=mysql><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://wlupus.github.io/mysql_connection/ data-title="Mysql Connection"><i data-svg-src=/lib/simple-icons/icons/line.min.svg></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/mysql/>mysql</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/git_proxy_settings/ class=prev rel=prev title="Windows Git 代理配置"><i class="fas fa-angle-left fa-fw"></i>Windows Git 代理配置</a>
<a href=/react_tutorial/ class=next rel=next title="React 入门笔记">React 入门笔记<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></main><footer class=footer><div class=footer-container><div class="footer-line copyright"><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>
<a href=https://wlupus.github.io target=_blank rel="external nofollow noopener noreffer">wlupus</a></span><span class=footer-divider></span><span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js async defer></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js defer></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js defer></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js defer></script><script type=text/javascript src=/lib/sharer/sharer.min.js async defer></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js defer></script><script type=text/javascript src=/lib/pangu/pangu.min.js defer></script><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",editLockTitle:"锁定可编辑代码块",editUnLockTitle:"解锁可编辑代码块",editable:!0,maxShownLines:10},comment:{},cookieconsent:{content:{dismiss:"同意",link:"了解更多",message:"本网站使用 Cookies 来改善您的浏览体验."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},enablePWA:!0,enablePangu:!0,lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1}}</script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript src=/js/_custom.min.js defer></script></body></html>